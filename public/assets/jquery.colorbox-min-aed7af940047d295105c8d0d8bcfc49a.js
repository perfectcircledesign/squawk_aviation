// Copyright (c) 2011 Jack Moore - jack@colorpowered.com
!function(e,t,i){function o(t){if(!O){if(D=t,s(e.extend(te,e.data(D,G))),y=e(D),F=0,"nofollow"!==te.rel&&(y=e("."+ie).filter(function(){var t=e.data(this,G).rel||this.rel;return t===te.rel}),F=y.index(D),F===-1&&(y=y.add(D),F=y.length-1)),!B){if(B=j=!0,c.show(),te.returnFocus)try{D.blur(),e(D).one(V,function(){try{this.focus()}catch(e){}})}catch(e){}a.css({opacity:+te.opacity,cursor:te.overlayClose?"pointer":"auto"}).show(),te.w=l(te.initialWidth,"x"),te.h=l(te.initialHeight,"y"),A.position(0),Z&&v.bind("resize."+ee+" scroll."+ee,function(){a.css({width:v.width(),height:v.height(),top:v.scrollTop(),left:v.scrollLeft()})}).trigger("resize."+ee),h(Q,te.onOpen),E.add(T).hide(),L.html(te.close).show()}A.load(!0)}}function n(){var e,t,i,o=N+"Slideshow_",n="click."+N;te.slideshow&&y[1]?(t=function(){W.text(te.slideshowStop).unbind(n).bind(J,function(){(F<y.length-1||te.loop)&&(e=setTimeout(A.next,te.slideshowSpeed))}).bind($,function(){clearTimeout(e)}).one(n+" "+U,i),c.removeClass(o+"off").addClass(o+"on"),e=setTimeout(A.next,te.slideshowSpeed)},i=function(){clearTimeout(e),W.text(te.slideshowStart).unbind([J,$,U,n].join(" ")).one(n,t),c.removeClass(o+"on").addClass(o+"off")},te.slideshowAuto?t():i()):c.removeClass(o+"off "+o+"on")}function h(t,i){i&&i.call(D),e.event.trigger(t)}function s(t){for(var i in t)e.isFunction(t[i])&&"on"!==i.substring(0,2)&&(t[i]=t[i].call(D));t.rel=t.rel||D.rel||"nofollow",t.href=t.href||e(D).attr("href"),t.title=t.title||D.title,"string"==typeof t.href&&(t.href=e.trim(t.href))}function r(e){return te.photo||/\.(gif|png|jpg|jpeg|bmp)(?:\?([^#]*))?(?:#(\.*))?$/i.test(e)}function l(e,t){return t="x"===t?v.width():v.height(),"string"==typeof e?Math.round(/%/.test(e)?t/100*parseInt(e,10):parseInt(e,10)):e}function d(i,o){var n=t.createElement("div");return i&&(n.id=N+i),n.style.cssText=o||"",e(n)}var a,c,u,f,p,m,w,g,y,v,x,b,C,T,H,W,k,I,L,E,M,S,_,K,D,F,z,B,j,O,P,R,A,q={transition:"elastic",speed:300,width:!1,initialWidth:"600",innerWidth:!1,maxWidth:!1,height:!1,initialHeight:"450",innerHeight:!1,maxHeight:!1,scalePhotos:!0,scrolling:!0,inline:!1,html:!1,iframe:!1,fastIframe:!0,photo:!1,href:!1,title:!1,rel:!1,opacity:.9,preloading:!0,current:"image {current} of {total}",previous:"previous",next:"next",close:"close",open:!1,returnFocus:!0,loop:!0,slideshow:!1,slideshowAuto:!0,slideshowSpeed:2500,slideshowStart:"start slideshow",slideshowStop:"stop slideshow",onOpen:!1,onLoad:!1,onComplete:!1,onCleanup:!1,onClosed:!1,overlayClose:!0,escKey:!0,arrowKey:!0,top:!1,bottom:!1,left:!1,right:!1,fixed:!1,data:!1},G="colorbox",N="cbox",Q=N+"_open",$=N+"_load",J=N+"_complete",U=N+"_cleanup",V=N+"_closed",X=N+"_purge",Y=e.browser.msie&&!e.support.opacity,Z=Y&&e.browser.version<7,ee=N+"_IE6",te={},ie=N+"Element";A=e.fn[G]=e[G]=function(t,i){var n,h=this;return!h[0]&&h.selector?h:(t=t||{},i&&(t.onComplete=i),h[0]&&void 0!==h.selector||(h=e("<a/>"),t.open=!0),h.each(function(){e.data(this,G,e.extend({},e.data(this,G)||q,t)),e(this).addClass(ie)}),n=t.open,e.isFunction(n)&&(n=n.call(h)),n&&o(h[0]),h)},A.init=function(){v=e(i),c=d().attr({id:G,"class":Y?N+(Z?"IE6":"IE"):""}),a=d("Overlay",Z?"position:absolute":"").hide(),u=d("Wrapper"),f=d("Content").append(x=d("LoadedContent","width:0; height:0; overflow:hidden"),C=d("LoadingOverlay").add(d("LoadingGraphic")),T=d("Title"),H=d("Current"),k=d("Next"),I=d("Previous"),W=d("Slideshow").bind(Q,n),L=d("Close")),u.append(d().append(d("TopLeft"),p=d("TopCenter"),d("TopRight")),d(!1,"clear:left").append(m=d("MiddleLeft"),f,w=d("MiddleRight")),d(!1,"clear:left").append(d("BottomLeft"),g=d("BottomCenter"),d("BottomRight"))).children().children().css({"float":"left"}),b=d(!1,"position:absolute; width:9999px; visibility:hidden; display:none"),e("body").prepend(a,c.append(u,b)),f.children().hover(function(){e(this).addClass("hover")},function(){e(this).removeClass("hover")}).addClass("hover"),M=p.height()+g.height()+f.outerHeight(!0)-f.height(),S=m.width()+w.width()+f.outerWidth(!0)-f.width(),_=x.outerHeight(!0),K=x.outerWidth(!0),c.css({"padding-bottom":M,"padding-right":S}).hide(),k.click(function(){A.next()}),I.click(function(){A.prev()}),L.click(function(){A.close()}),E=k.add(I).add(H).add(W),f.children().removeClass("hover"),a.click(function(){te.overlayClose&&A.close()}),e(t).bind("keydown."+N,function(e){var t=e.keyCode;B&&te.escKey&&27===t&&(e.preventDefault(),A.close()),B&&te.arrowKey&&y[1]&&(37===t?(e.preventDefault(),I.click()):39===t&&(e.preventDefault(),k.click()))})},A.remove=function(){c.add(a).remove(),e("."+ie).removeData(G).removeClass(ie)},A.position=function(e,i){function o(e){p[0].style.width=g[0].style.width=f[0].style.width=e.style.width,C[0].style.height=C[1].style.height=f[0].style.height=m[0].style.height=w[0].style.height=e.style.height}var n,h=0,s=0;c.hide(),te.fixed&&!Z?c.css({position:"fixed"}):(h=v.scrollTop(),s=v.scrollLeft(),c.css({position:"absolute"})),s+=te.right!==!1?Math.max(v.width()-te.w-K-S-l(te.right,"x"),0):te.left!==!1?l(te.left,"x"):Math.max(v.width()-te.w-K-S,0)/2,h+=te.bottom!==!1?Math.max(t.documentElement.clientHeight-te.h-_-M-l(te.bottom,"y"),0):te.top!==!1?l(te.top,"y"):Math.max(t.documentElement.clientHeight-te.h-_-M,0)/2,c.show(),n=c.width()===te.w+K&&c.height()===te.h+_?0:e,u[0].style.width=u[0].style.height="9999px",c.dequeue().animate({width:te.w+K,height:te.h+_,top:h,left:s},{duration:n,complete:function(){o(this),j=!1,u[0].style.width=te.w+K+S+"px",u[0].style.height=te.h+_+M+"px",i&&i()},step:function(){o(this)}})},A.resize=function(e){if(B){if(e=e||{},e.width&&(te.w=l(e.width,"x")-K-S),e.innerWidth&&(te.w=l(e.innerWidth,"x")),x.css({width:te.w}),e.height&&(te.h=l(e.height,"y")-_-M),e.innerHeight&&(te.h=l(e.innerHeight,"y")),!e.innerHeight&&!e.height){var t=x.wrapInner("<div style='overflow:auto'></div>").children();te.h=t.height(),t.replaceWith(t.children())}x.css({height:te.h}),A.position("none"===te.transition?0:te.speed)}},A.prep=function(t){function i(t){A.position(t,function(){function t(){Y&&c[0].style.removeAttribute("filter")}var i,o,n,l,d,a,u=y.length;!B||(a=function(){clearTimeout(R),C.hide(),h(J,te.onComplete)},Y&&z&&x.fadeIn(100),T.html(te.title).add(x).show(),u>1?("string"==typeof te.current&&H.html(te.current.replace(/\{current\}/,F+1).replace(/\{total\}/,u)).show(),k[te.loop||F<u-1?"show":"hide"]().html(te.next),I[te.loop||F?"show":"hide"]().html(te.previous),i=F?y[F-1]:y[u-1],n=F<u-1?y[F+1]:y[0],te.slideshow&&W.show(),te.preloading&&(l=e.data(n,G).href||n.href,o=e.data(i,G).href||i.href,l=e.isFunction(l)?l.call(n):l,o=e.isFunction(o)?o.call(i):o,r(l)&&(e("<img/>")[0].src=l),r(o)&&(e("<img/>")[0].src=o))):E.hide(),te.iframe?(d=e("<iframe/>").addClass(N+"Iframe")[0],te.fastIframe?a():e(d).one("load",a),d.name=N+ +new Date,d.src=te.href,te.scrolling||(d.scrolling="no"),Y&&(d.frameBorder=0,d.allowTransparency="true"),e(d).appendTo(x).one(X,function(){d.src="//about:blank"})):a(),"fade"===te.transition?c.fadeTo(s,1,t):t(),v.bind("resize."+N,function(){A.position(0)}))})}function o(){return te.h=te.h||x.height(),te.h=te.mh&&te.mh<te.h?te.mh:te.h,te.h}function n(){return te.w=te.w||x.width(),te.w=te.mw&&te.mw<te.w?te.mw:te.w,te.w}if(B){var s="none"===te.transition?0:te.speed;v.unbind("resize."+N),x.remove(),x=d("LoadedContent").html(t),x.hide().appendTo(b.show()).css({width:n(),overflow:te.scrolling?"auto":"hidden"}).css({height:o()}).prependTo(f),b.hide(),e(z).css({"float":"none"}),Z&&e("select").not(c.find("select")).filter(function(){return"hidden"!==this.style.visibility}).css({visibility:"hidden"}).one(U,function(){this.style.visibility="inherit"}),"fade"===te.transition?c.fadeTo(s,0,function(){i(0)}):i(s)}},A.load=function(t){var i,o,n=A.prep;j=!0,z=!1,D=y[F],t||s(e.extend(te,e.data(D,G))),h(X),h($,te.onLoad),te.h=te.height?l(te.height,"y")-_-M:te.innerHeight&&l(te.innerHeight,"y"),te.w=te.width?l(te.width,"x")-K-S:te.innerWidth&&l(te.innerWidth,"x"),te.mw=te.w,te.mh=te.h,te.maxWidth&&(te.mw=l(te.maxWidth,"x")-K-S,te.mw=te.w&&te.w<te.mw?te.w:te.mw),te.maxHeight&&(te.mh=l(te.maxHeight,"y")-_-M,te.mh=te.h&&te.h<te.mh?te.h:te.mh),i=te.href,R=setTimeout(function(){C.show()},100),te.inline?(d().hide().insertBefore(e(i)[0]).one(X,function(){e(this).replaceWith(x.children())}),n(e(i))):te.iframe?n(" "):te.html?n(te.html):r(i)?(e(z=new Image).addClass(N+"Photo").error(function(){te.title=!1,n(d("Error").text("This image could not be loaded"))}).load(function(){var e;z.onload=null,te.scalePhotos&&(o=function(){z.height-=z.height*e,z.width-=z.width*e},te.mw&&z.width>te.mw&&(e=(z.width-te.mw)/z.width,o()),te.mh&&z.height>te.mh&&(e=(z.height-te.mh)/z.height,o())),te.h&&(z.style.marginTop=Math.max(te.h-z.height,0)/2+"px"),y[1]&&(F<y.length-1||te.loop)&&(z.style.cursor="pointer",z.onclick=function(){A.next()}),Y&&(z.style.msInterpolationMode="bicubic"),setTimeout(function(){n(z)},1)}),setTimeout(function(){z.src=i},1)):i&&b.load(i,te.data,function(t,i,o){n("error"===i?d("Error").text("Request unsuccessful: "+o.statusText):e(this).contents())})},A.next=function(){!j&&y[1]&&(F<y.length-1||te.loop)&&(F=F<y.length-1?F+1:0,A.load())},A.prev=function(){!j&&y[1]&&(F||te.loop)&&(F=F?F-1:y.length-1,A.load())},A.close=function(){B&&!O&&(O=!0,B=!1,h(U,te.onCleanup),v.unbind("."+N+" ."+ee),a.fadeTo(200,0),c.stop().fadeTo(300,0,function(){c.add(a).css({opacity:1,cursor:"auto"}).hide(),h(X),x.remove(),setTimeout(function(){O=!1,h(V,te.onClosed)},1)}))},A.element=function(){return e(D)},A.settings=q,P=function(e){0!==e.button&&"undefined"!=typeof e.button||e.ctrlKey||e.shiftKey||e.altKey||(e.preventDefault(),o(this))},e.fn.delegate?e(t).delegate("."+ie,"click",P):e("."+ie).live("click",P),e(A.init)}(jQuery,document,this);