$.fn.extend({everyTime:function(e,t,i,r){return this.each(function(){$.timer.add(this,e,t,i,r)})},oneTime:function(e,t,i){return this.each(function(){$.timer.add(this,e,t,i,1)})},stopTime:function(e,t){return this.each(function(){$.timer.remove(this,e,t)})}}),$.extend({timer:{global:[],guid:1,dataKey:"$.timer",regex:/^([0-9]+(?:\.[0-9]*)?)\s*(.*s)?$/,powers:{ms:1,cs:10,ds:100,s:1e3,das:1e4,hs:1e5,ks:1e6},timeParse:function(e){if(void 0==e||null==e)return null;var t=this.regex.exec($.trim(e.toString()));if(t[2]){var i=parseFloat(t[1]),r=this.powers[t[2]]||1;return i*r}return e},add:function(e,t,i,r,n){var a=0;if($.isFunction(i)&&(n||(n=r),r=i,i=t),t=$.timer.timeParse(t),!("number"!=typeof t||isNaN(t)||t<0)){("number"!=typeof n||isNaN(n)||n<0)&&(n=0),n=n||0;var o=$.data(e,this.dataKey)||$.data(e,this.dataKey,{});o[i]||(o[i]={}),r.timerID=r.timerID||this.guid++;var s=function(){(++a>n&&0!==n||r.call(e,a)===!1)&&$.timer.remove(e,i,r)};s.timerID=r.timerID,o[i][r.timerID]||(o[i][r.timerID]=window.setInterval(s,t)),this.global.push(e)}},remove:function(e,t,i){var r,n=$.data(e,this.dataKey);if(n){if(t){if(n[t]){if(i)i.timerID&&(window.clearInterval(n[t][i.timerID]),delete n[t][i.timerID]);else for(var i in n[t])window.clearInterval(n[t][i]),delete n[t][i];for(r in n[t])break;r||(r=null,delete n[t])}}else for(t in n)this.remove(e,t,i);for(r in n)break;r||$.removeData(e,this.dataKey)}}}}),$(window).bind("unload",function(){$.each($.timer.global,function(e,t){$.timer.remove(t)})});